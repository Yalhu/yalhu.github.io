<a id="more"></a>
<p style="text-align:right"> 2021.12.27 星期一 : </p>


<h1 id="Taro方式"><a href="#Taro方式" class="headerlink" title="Taro方式"></a>Taro方式</h1><p>Taro文档-进阶指南-第三方工具-Jest: <a href="https://nervjs.github.io/taro-docs/docs/external-libraries#jest" target="_blank" rel="noopener">https://nervjs.github.io/taro-docs/docs/external-libraries#jest</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  globals: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">window</span>: <span class="literal">true</span>,</span><br><span class="line">    ENABLE_INNER_HTML: <span class="literal">true</span>,</span><br><span class="line">    ENABLE_ADJACENT_HTML: <span class="literal">true</span>,</span><br><span class="line">    ENABLE_SIZE_APIS: <span class="literal">true</span>,</span><br><span class="line">    ENABLE_TEMPLATE_CONTENT: <span class="literal">true</span>,</span><br><span class="line">    ENABLE_CLONE_NODE: <span class="literal">true</span>,</span><br><span class="line">    ENABLE_CONTAINS: <span class="literal">true</span>,</span><br><span class="line">    ENABLE_MUTATION_OBSERVER: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  moduleNameMapper: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="string">'@tarojs/taro'</span>: <span class="string">'@tarojs/taro-h5'</span>,</span><br><span class="line">    <span class="comment">// '@tarojs/components': '@tarojs/components/dist-h5/react',</span></span><br><span class="line">    <span class="comment">// '@tarojs/plugin-framework-react/dist/runtime': '&lt;rootDir&gt;/__mocks__/taro-framework',</span></span><br><span class="line">    <span class="comment">// '@tarojs/plugin-framework-vue2/dist/runtime': '&lt;rootDir&gt;/__mocks__/taro-framework',</span></span><br><span class="line">    <span class="comment">// '@tarojs/plugin-framework-vue3/dist/runtime': '&lt;rootDir&gt;/__mocks__/taro-framework',</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该方法不适用路由跳转和部分生命周期测试。</p>
</blockquote>
<p>PS: 没跑通。直接mock了整个taro.js。</p>
<!-- 
上面方式报错了：
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">FAIL  <span class="built_in">test</span>/pages/detail.spec.js</span><br><span class="line"> ● Test suite failed to run</span><br><span class="line"></span><br><span class="line">   Jest encountered an unexpected token</span><br><span class="line"></span><br><span class="line">   Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.</span><br><span class="line"></span><br><span class="line">   Out of the box Jest supports Babel, <span class="built_in">which</span> will be used to transform your files into valid JS based on your Babel configuration.</span><br><span class="line"></span><br><span class="line">   By default <span class="string">"node_modules"</span> folder is ignored by transformers.</span><br><span class="line"></span><br><span class="line">   Here<span class="string">'s what you can do:</span></span><br><span class="line"><span class="string">    • If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.</span></span><br><span class="line"><span class="string">    • If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript</span></span><br><span class="line"><span class="string">    • To have some of your "node_modules" files transformed, you can specify a custom "transformIgnorePatterns" in your config.</span></span><br><span class="line"><span class="string">    • If you need a custom transformation specify a "transform" option in your config.</span></span><br><span class="line"><span class="string">    • If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the "moduleNameMapper" config option.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   You'</span>ll find more details and examples of these config options <span class="keyword">in</span> the docs:</span><br><span class="line">   https://jestjs.io/docs/configuration</span><br><span class="line">   For information about custom transformations, see:</span><br><span class="line">   https://jestjs.io/docs/code-transformation</span><br><span class="line"></span><br><span class="line">   Details:</span><br><span class="line"></span><br><span class="line">   /Users/huyalong1/working/shop/order/node_modules/@babel/runtime/helpers/esm/extends.js:1</span><br><span class="line">   (&#123;<span class="string">"Object.&lt;anonymous&gt;"</span>:<span class="keyword">function</span>(module,exports,require,__dirname,__filename,jest)&#123;<span class="built_in">export</span> default <span class="keyword">function</span> <span class="function"><span class="title">_extends</span></span>() &#123;</span><br><span class="line">                                                                                     ^^^^^^</span><br><span class="line"></span><br><span class="line">   SyntaxError: Unexpected token <span class="string">'export'</span></span><br><span class="line"></span><br><span class="line">     at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1728:14)</span><br><span class="line">     at Object.&lt;anonymous&gt; (node_modules/@tarojs/router/dist/index.js:7:16)</span><br></pre></td></tr></table></figure>
<p>–&gt;</p>
<h1 id="实际使用"><a href="#实际使用" class="headerlink" title="实际使用"></a>实际使用</h1><p>tarojs是react项目，所以可用react的单元测试方案。<br>但是，会有一些不一样。比如taro/components 及api 等。</p>
<!-- 
taro 3.x unit test demo: https://github.com/Kevin170113664/taro-dojo 
PS: 找了一个taro单测的实例。但是用的chai。
--> 
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><!-- 
[Taro@3+版本中集成jest+enzyme自动化测试](https://juejin.cn/post/7021808537630146574) 
PS: taro + jest + enzyme 快速开始。简单实用。
-->
<p>注意配置<code>snapshotSerializers</code>，否则快照内容为空。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* test/setup.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> Adapter <span class="keyword">from</span> <span class="string">'@wojtekmaj/enzyme-adapter-react-17'</span>;</span><br><span class="line"></span><br><span class="line">configure(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> Adapter() &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* test/jest.config.js */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//   verbose: true,</span></span><br><span class="line">    testEnvironment: <span class="string">"jsdom"</span>,</span><br><span class="line">    rootDir: path.resolve(__dirname, <span class="string">"../"</span>),</span><br><span class="line">    setupFilesAfterEnv: [<span class="string">"&lt;rootDir&gt;/test/setup"</span>],</span><br><span class="line">    moduleNameMapper: &#123;</span><br><span class="line">        <span class="string">'@tarojs/components'</span>: <span class="string">'@tarojs/components/dist-h5/react'</span>,</span><br><span class="line">        <span class="string">"\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$"</span>:</span><br><span class="line">            <span class="string">"&lt;rootDir&gt;/test/mocks/emptyMock.js"</span>,</span><br><span class="line">        <span class="string">"\\.(css|less|scss)$"</span>: <span class="string">"&lt;rootDir&gt;/test/mocks/emptyMock.js"</span>,</span><br><span class="line">        <span class="string">'^@/(.*)$'</span>: <span class="string">'&lt;rootDir&gt;/src/$1'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">     transform: &#123;</span><br><span class="line">        <span class="string">"^.+\\.[t|j]sx?$"</span>: <span class="string">"babel-jest"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    transformIgnorePatterns: [</span><br><span class="line">        <span class="string">'&lt;rootDir&gt;/node_modules/(?!((@tarojs)|(@base))/)'</span>,</span><br><span class="line">    ],</span><br><span class="line">    snapshotSerializers: [<span class="string">"enzyme-to-json/serializer"</span>],</span><br><span class="line">    setupFilesAfterEnv: [<span class="string">"&lt;rootDir&gt;/test/setup"</span>],</span><br><span class="line">    moduleFileExtensions: [<span class="string">"ts"</span>, <span class="string">"tsx"</span>, <span class="string">"js"</span>, <span class="string">"jsx"</span>, <span class="string">"json"</span>, <span class="string">"node"</span>],</span><br><span class="line">    testPathIgnorePatterns: [</span><br><span class="line">        <span class="string">"/node_modules"</span>,</span><br><span class="line">        <span class="comment">// '^.+\\.(css|sass|scss|less)$',</span></span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="taroMock"><a href="#taroMock" class="headerlink" title="taroMock"></a>taroMock</h2><p>通过<code>moduleNameMapper</code>mock了整个taro.js。<br>并不关心taro的内部实现；还可以加速。</p>
<blockquote>
<p>Taro-H5 中使用到的 API 实际上并不在 @tarojs/taro 的入口文件之下。<br>使用 Jest 测试也是类似，需要添加配置如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> handleApiMock <span class="keyword">from</span> <span class="string">'./apiMock'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getApp = jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> (&#123;&#125;));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCurrentInstance = jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    page: &#123;&#125;,</span><br><span class="line">    router: &#123;</span><br><span class="line">        params: &#123;</span><br><span class="line">            dealId: <span class="string">'245777499999'</span>, <span class="comment">// follow</span></span><br><span class="line">            dealState: <span class="string">'18'</span>, <span class="comment">// follow</span></span><br><span class="line">            id: <span class="string">''</span>, <span class="comment">// remind</span></span><br><span class="line">            phone: <span class="string">''</span> <span class="comment">// remind</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCurrentPages = jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> (&#123;&#125;));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setNavigationBarTitle = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStorageSync = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setStorageSync = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSystemInfoSync = jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> (&#123;&#125;));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSystemInfo = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useDidShow = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useDidHide = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useReachBottom = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useShareAppMessage = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getEnv = jest.fn();</span><br><span class="line"><span class="comment">// export const request = jest.fn();</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> request = jest.fn().mockImplementation(handleApiMock);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addInterceptor = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getNetworkType = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> usePageScroll = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> commonGetData = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> showToast = jest.fn();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> showModal = jest.fn(<span class="function">(<span class="params">&#123;success, fail&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    success &amp;&amp; success();</span><br><span class="line">    fail &amp;&amp; fail();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> eventCenter = &#123;</span><br><span class="line">    on: jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> eventCenter),</span><br><span class="line">    off: jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> eventCenter),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Taro = &#123;</span><br><span class="line">    getApp,</span><br><span class="line">    getCurrentInstance,</span><br><span class="line">    getCurrentPages,</span><br><span class="line">    setNavigationBarTitle,</span><br><span class="line">    getStorageSync,</span><br><span class="line">    setStorageSync,</span><br><span class="line">    getSystemInfoSync,</span><br><span class="line">    getSystemInfo,</span><br><span class="line">    useDidShow,</span><br><span class="line">    useDidHide,</span><br><span class="line">    useShareAppMessage,</span><br><span class="line">    useReachBottom,</span><br><span class="line">    getEnv,</span><br><span class="line">    ENV_TYPE: &#123;&#125;,</span><br><span class="line">    request,</span><br><span class="line">    addInterceptor,</span><br><span class="line">    getNetworkType,</span><br><span class="line">    usePageScroll,</span><br><span class="line">    commonGetData,</span><br><span class="line">    showModal,</span><br><span class="line">    showToast,</span><br><span class="line">    eventCenter,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Taro</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="分支测试"><a href="#分支测试" class="headerlink" title="分支测试"></a>分支测试</h2><p>process.env.TARO_ENV<br>package.json <code>&quot;test&quot;: &quot;cross-env JEST_REPORT_FILE=&#39;./test/report/test-report.json&#39; TARO_ENV=h5 jest --config test/jest.conf.js&quot;,</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">globals: &#123;</span><br><span class="line">    <span class="string">"process.env.TARO_ENV"</span>: process.env.TARO_ENV,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>另一种方式：在jest配置文件中直接赋值<!-- package文件中不需要了 --><code>process.env = Object.assign(process.env, {TARO_ENV: &#39;h5&#39;});</code><br><!-- 这两个配置都需要啊。通webpack 定义和使用环境变量的方式。 --></p>
<p>问题：<code>ReferenceError: $RefreshSig$ is not defined</code>， <code>ReferenceError: $RefreshReg$ is not defined</code><br>setup.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">global.$RefreshReg$ = () =&gt; &#123;&#125;;</span><br><span class="line">global.$RefreshSig$ = () =&gt; () =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure></p>
<!-- 
参考： 
[ReferenceError: $RefreshReg$ is not defined](https://stackoverflow.com/questions/66472945/referenceerror-refreshreg-is-not-defined)
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV != <span class="string">'production'</span>) &#123;</span><br><span class="line">  global.$RefreshReg$ = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">  global.$RefreshSig$ = <span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单。直接成功了。<br>–&gt;</p>
<!-- 
[Webpack使用ReactRefreshWebpackPlugin对JSX文件进行本地热更新解析时 $RefreshSig$ is not defined](https://cloud.tencent.com/developer/article/2033374)
PS: 需要关注才可以察看。可以看出和热更新有关。

[【taro react】---- 编译H5运行后报错：Uncaught ReferenceError: $RefreshSig$ is not defined](https://blog.csdn.net/m0_38082783/article/details/124984203)
`npx browserslist@latest --update-db`
PS: run dev:h5 是成功。而且安装失败了
 -->
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li><p>taro项目中cookie是多端文件，会报错。<code>RangeError: Maximum call stack size exceeded</code><br>解决：用mockModule的方式，指向index.h5.js。<br>原因：可能是在小程序的cookie utils中发生了什么事情。</p>
</li>
<li><p>引入tarojs/components 出错。已经指向了h5的components了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SyntaxError: Cannot use import statement outside a module</span><br><span class="line"></span><br><span class="line">1 | import React, &#123; useState, useEffect, useRef, useCallback &#125; from &quot;react&quot;;</span><br><span class="line">&gt; 2 | import &#123; View, Text &#125; from &quot;@tarojs/components&quot;;</span><br><span class="line">3 | import styles from &quot;./index.module.scss&quot;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">By default &quot;node_modules&quot; folder is ignored by transformers.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>默认忽略了node_modules 文件夹。<br>所以要进行配置。包括其他node_modules需要忽略的依赖。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">transformIgnorePatterns: [</span><br><span class="line">    <span class="string">'&lt;rootDir&gt;/node_modules/(?!((@tarojs)|(@base/datetime)|(@base/logger))/)'</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure></p>
<!-- 
或者去mock 组件？？ 
不合适吧！！ 
[在react项目中跑jest的测试报错：Element type is invalid: expected](https://segmentfault.com/q/1010000020213788?utm_source=sf-similar-question)
 -->
<ol>
<li>tarojs 引用出错。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ReferenceError: ENABLE_INNER_HTML is not defined</span><br><span class="line"></span><br><span class="line">     1 | import React, &#123; useState, useRef, useEffect, useCallback &#125; from &quot;react&quot;;</span><br><span class="line">   &gt; 2 | import Taro from &quot;@tarojs/taro&quot;;</span><br><span class="line">       | ^</span><br><span class="line">     3 | import &#123; View, Text, Image &#125; from &quot;@tarojs/components&quot;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>看出是tarojs的api 引入出错。<br>所以需要mock。可以在每个文件中单独mock，或者通过映射（moduleNameMapper）统一处理。</p>
<ol>
<li>引用路径/别名出错。<br>包括webpack别名的设置。<br><del><code>Could not locate module @/utils/Cookie mapped as: /Users/myfolder/shop/order/src/$1.</code></del><!-- 可能是cookie文件的后缀当时写成ts了。 -->
需要配置模块映射。(优先从上面找)。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">moduleNameMapper: &#123;</span><br><span class="line">    <span class="string">'@tarojs/taro'</span>: <span class="string">'&lt;rootDir&gt;/test/mocks/taroMock.js'</span>,</span><br><span class="line">    <span class="string">'@tarojs/components'</span>: <span class="string">'@tarojs/components/dist-h5/react'</span>,</span><br><span class="line">    <span class="string">"\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$"</span>:</span><br><span class="line">        <span class="string">"&lt;rootDir&gt;/test/mocks/fileMock.js"</span>,</span><br><span class="line">    <span class="string">"\\.(css|less|scss)$"</span>: <span class="string">"&lt;rootDir&gt;/test/mocks/styleMock.js"</span>,</span><br><span class="line">    <span class="string">'@/utils/Cookie'</span>: <span class="string">'&lt;rootDir&gt;/src/utils/Cookie/index.h5.js'</span>,</span><br><span class="line">    <span class="string">'^@/(.*)$'</span>: <span class="string">'&lt;rootDir&gt;/src/$1'</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>可以看到还有一些css和tarojs 的映射。</p>
